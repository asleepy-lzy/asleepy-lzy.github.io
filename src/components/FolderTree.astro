---
import type { FolderTreeNode } from "../utils/content-utils";
import { getPostUrlBySlug } from "../utils/url-utils";

interface Props {
	node: FolderTreeNode;
	depth?: number;
}

const { node, depth = 0 } = Astro.props;
const indent = Math.min(depth * 1.25, 4);
const isRootLevel = depth === 0;
const nodeClass = `folder-node${isRootLevel ? " folder-node-root" : ""}`;
---

{node.path && (
	<details open class={nodeClass}>
		<summary style={`padding-left: ${indent}rem`}>
			<span class="folder-left">
				<span class="folder-chevron" aria-hidden="true">âŒ„</span>
				<span class="folder-name">{node.name}</span>
			</span>
			<span class="folder-count">{node.count}</span>
		</summary>
		<div class="folder-body">
			{node.posts.length > 0 && (
				<ul class="folder-posts" style={`padding-left: ${indent + 1.5}rem`}>
					{node.posts.map((post) => (
						<li>
							<a class="folder-post-link" href={getPostUrlBySlug(post.slug)}>
								<span class="file-icon" aria-hidden="true">ðŸ“„</span>
								{post.title}
							</a>
						</li>
					))}
				</ul>
			)}
			{node.children.map((child) => (
				<Astro.self node={child} depth={depth + 1} />
			))}
		</div>
	</details>
)}

{!node.path && (
	<div class="folder-root">
		{node.children.map((child) => (
			<Astro.self node={child} depth={0} />
		))}
	</div>
)}

<style>
	.folder-root {
		display: flex;
		flex-direction: column;
		gap: 0.9rem;
	}

	.folder-node {
		background: transparent;
	}

	.folder-node summary {
		cursor: pointer;
		list-style: none;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 0.75rem;
		padding: 0.85rem 1.1rem;
		font-weight: 700;
		color: rgba(0, 0, 0, 0.8);
		background: transparent;
		transition: background 140ms ease;
	}

	.folder-node summary::-webkit-details-marker {
		display: none;
	}

	.folder-node summary:hover {
		background: var(--btn-plain-bg-hover);
	}

	.folder-body {
		padding: 0.35rem 0.4rem 0.7rem;
		border-left: 1px solid var(--line-divider);
		margin-left: 1.1rem;
	}

	.folder-left {
		display: inline-flex;
		align-items: center;
		gap: 0.6rem;
	}

	.folder-chevron {
		display: inline-flex;
		width: 1.25rem;
		height: 1.25rem;
		align-items: center;
		justify-content: center;
		color: var(--primary);
		transition: transform 140ms ease;
	}

	.folder-node[open] .folder-chevron {
		transform: rotate(0deg);
	}

	.folder-node:not([open]) .folder-chevron {
		transform: rotate(-90deg);
	}

	.folder-name {
		color: rgba(0, 0, 0, 0.8);
		font-size: 1.05rem;
		line-height: 1.6;
	}

	.folder-count {
		font-size: 12px;
		color: var(--btn-content);
		background: var(--btn-regular-bg);
		padding: 0.15rem 0.55rem;
		border-radius: 999px;
	}

	.folder-posts {
		display: flex;
		flex-direction: column;
		gap: 0.4rem;
		margin: 0.6rem 0 0.35rem;
	}

	.folder-post-link {
		display: inline-block;
		color: rgba(0, 0, 0, 0.7);
		text-decoration: none;
		position: relative;
		padding: 0.45rem 0.6rem;
		border-radius: 0.6rem;
		transition: background 140ms ease, color 140ms ease;
	}

	.folder-post-link:hover {
		color: var(--primary);
		background: var(--btn-plain-bg-hover);
	}

	.file-icon {
		margin-right: 0.4rem;
		color: var(--primary);
	}

	.folder-node-root {
		border: 1px solid var(--line-divider);
		border-radius: 1rem;
		background: var(--card-bg);
		box-shadow: 0 10px 26px rgba(0, 0, 0, 0.06);
		padding-bottom: 0.2rem;
	}

	.folder-node-root > summary {
		padding: 1rem 1.25rem;
	}

	.folder-node-root > .folder-body {
		border-left: none;
		margin-left: 0;
		padding: 0.4rem 0.9rem 0.9rem;
	}

	:global(.dark) .folder-node summary,
	:global(.dark) .folder-name {
		color: rgba(255, 255, 255, 0.85);
	}

	:global(.dark) .folder-post-link {
		color: rgba(255, 255, 255, 0.7);
	}

	:global(.dark) .folder-node-root {
		box-shadow: none;
	}
</style>
